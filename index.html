<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html, body {
            margin: 0;
            padding: 0;
        }
        html {
            font-size: 3vw;
            font-family: Arial, Helvetica, sans-serif;
            font-weight: bold;
            background: #5f53e0;
            color: rgb(210, 210, 210);
        }
    </style>
</head>
<body>
    <div style="display: flex; flex-direction: column; align-items: center; width: 100%;">
        <img src="tv.png" style="width: 100%; height: auto; cursor: pointer;" onclick="doanimate()">
        <div style="width: 100%; font-size: 0.6em; color: #5f53e0; text-align: center; display: flex; box-sizing: border-box;">
            <textarea oninput="drawtext()"
                style="font-family: Arial, Helvetica, sans-serif; font-size: 1.2em; color: white; background: #544caa; flex: 1; height: 150px; padding: 10px; box-sizing: border-box;"
                type="text" id="textage">
            </textarea>
            <button style="margin-left: 5px; width: 14vw; height: 150px; vertical-align: top; font-size: 3vw; background: #5f53e0; cursor: pointer;" onclick="doanimate()">BARK</button>
        </div>
        <div style="font-size: 0.6em; color: white;">[ **Big Text / *Tall Text / Normal Text / 2x Newline is pause / Click BARK or TV to Play URL message ]</div>
    </div>
    <div id="wherewordsgo" style="position: absolute; left: 42vw; top: 13vw; padding-top: 1vw; padding-bottom: 1vw; width: 39vw; height: 43vw; font-size: 3vw; line-height: 3.5vw; word-spacing: 1vw; letter-spacing: 0.1vw; overflow: hidden;">
    </div>
    <div style="position: absolute; left: 0; top: 0;">
        <img src="front.png" id="dog" style="width: 80vw; height: auto; margin-left: 8vw; margin-top: 7vw;">
    </div>

    <script>
        document.getElementById("textage").value = "*BITE *BACK WITH **KENT_BROCKMAN \n\
\n\
AND HIS *CHANNEL *6 CONSUMER WATCHDOG UNIT";

        // Check for URL parameter (will be applied on first interaction)
        var urlParams = new URLSearchParams(window.location.search);
        var textParam = urlParams.get('text');
        var urlTextPending = textParam ? decodeURIComponent(textParam) : null;

        var cnt = 0;
        var audio = new Audio('bark.wav');
        audio.preload = "auto";

        var keyFrames = '\
        @keyframes ANIMNAME-IDLE { \
            100% {left: ANIMLEFTpx; top:ANIMTOPpx;color: #00000000;  transform: scale(0.2);} \
        } \
        @keyframes ANIMNAME-RUNNING { \
            from {left: ANIMLEFTpx; top:ANIMTOPpx; color:white; transform: scale(0.2);} \
            to {left: ANIMXpx; top: ANIMYpx; color:white; transform: scale(SCX, SCY);} \
        } \
    }';

        var cunt = 0;
        var pauses = [];

        drawtext();

        function myTimer() {
            var curr = cunt / 2;
            if (curr == cnt) {
                document.getElementById("dog").src = "front.png";
                return;
            }

            if (cunt % 2 == 0) {
                var thediv = document.getElementById(curr);

                if (pauses.includes(curr)) {
                    document.getElementById("dog").src = "front.png";

                    if (intid != -1) {
                        clearInterval(intid);
                        setTimeout(function () {
                            document.getElementById("dog").src = "bark.png";
                            thediv.style.animationName = "AN" + curr + "-RUNNING";
                            thediv.style.animationDuration = "0.25s";
                            thediv.style.animationFillMode = "forwards";
                            audio.play();
                            intid = setInterval(myTimer, 300);
                        }, 800);
                    }
                }
                else {
                    document.getElementById("dog").src = "bark.png";
                    thediv.style.animationName = "AN" + curr + "-RUNNING";
                    thediv.style.animationDuration = "0.25s";
                    thediv.style.animationFillMode = "forwards";
                    audio.play();
                }
            }
            else {
                document.getElementById("dog").src = "side.png";
            }
            cunt++;
        }

        function drawtext() {
            var text = document.getElementById("textage").value;
            var splittage = text.split('\n');
            var wherewordsgo = document.getElementById("wherewordsgo");
            cnt = 0;
            wherewordsgo.replaceChildren();
            pauses = [];

            for (var line of splittage) {
                var words = line.split(' ');

                if (words.length == 1 && words[0] == "") {
                    pauses.push(cnt);
                }
                else {
                    for (var wd of words) {
                        if (wd != "") {
                            const divDiv = document.createElement("div");
                            const newDiv = document.createElement("div");

                            wd = wd.replace("_", " "); // underscores are used to group words together
                            var word = "";

                            if (wd.includes("**")) {
                                newDiv.style = "display: inline-block; font-size: 3vw; line-height: 4vw; word-spacing: 1vw; letter-spacing: 0.1vw; transform: scale(1, 1.65); transform-origin: 0 50%; white-space: nowrap;";
                                divDiv.style = "display: inline-block;";
                                word = wd.replace("**", "");
                            } else if (wd.includes("*")) {
                                newDiv.style = "display: inline-block; font-size: 2.3vw; line-height: 3.5vw; word-spacing: 1vw; letter-spacing: 0.1vw; transform: scale(1, 1.4); transform-origin: 0 50%; white-space: nowrap;";
                                divDiv.style = "display: inline-block;";
                                word = wd.replace("*", "");
                            } else {
                                newDiv.style = "display: inline-block;";
                                divDiv.style = "display: inline-block;";
                                word = wd;
                            }

                            const newContent = document.createTextNode(word);
                            newDiv.appendChild(newContent);
                            divDiv.appendChild(newDiv);
                            divDiv.id = cnt;
                            wherewordsgo.appendChild(divDiv);

                            var space = document.createTextNode(" ");
                            wherewordsgo.appendChild(space);
                            cnt++;
                        }
                    }
                    var nuline = document.createElement("br");
                    wherewordsgo.appendChild(nuline);
                }
            }
        }

        var intid = -1;
        function doanimate(element, color) {
            cunt = 0;
            if (intid != -1)
                clearInterval(intid);

            // Apply URL text on first interaction
            if (urlTextPending) {
                document.getElementById("textage").value = urlTextPending;
                urlTextPending = null;
            }

            drawtext();

            // Update URL with current text
            var currentText = document.getElementById("textage").value;
            var newUrl = window.location.pathname + '?text=' + encodeURIComponent(currentText).replace(/\*/g, '%2A');
            history.replaceState(null, '', newUrl);

            // start backwards from the end to avoid wrap foulups
            var vw = window.innerWidth / 100;
            var wherewordsgoEl = document.getElementById("wherewordsgo");
            var containerLeft = getOffset(wherewordsgoEl).left;
            var containerTop = getOffset(wherewordsgoEl).top;

            for (x = cnt; x > 0; x--) {
                var thediv = document.getElementById(x - 1);

                var xpos = getOffset(thediv).left;
                var ypos = getOffset(thediv).top;

                var xwidth = thediv.getBoundingClientRect().width;
                var yheight = thediv.getBoundingClientRect().height;

                var ogleft = -(xwidth / 2) - (10 * vw);
                var ogtop = (11 * vw) - (yheight / 2);

                var animstyle = document.createElement('style');
                animstyle.type = 'text/css';

                animstyle.innerHTML =
                    keyFrames.replace(/ANIMX/g, xpos - containerLeft).
                        replace(/ANIMY/g, ypos - containerTop).
                        replace(/ANIMLEFT/g, ogleft).
                        replace(/ANIMTOP/g, ogtop).
                        replace(/SCX/g, 1.0).
                        replace(/SCY/g, 1.0).
                        replace(/ANIMNAME/g, "AN" + (x - 1));

                thediv.style.left = ogleft + "px";
                thediv.style.top = ogtop + "px";

                thediv.style.animationName = "AN" + (x - 1) + "-IDLE";
                thediv.style.animationDuration = "0s";
                thediv.style.animationFillMode = "forwards";

                document.getElementsByTagName('head')[0].appendChild(animstyle);
                thediv.style.position = "absolute";
            }
            intid = setInterval(myTimer, 300);
        }

        function getOffset(el) {
            const rect = el.getBoundingClientRect();
            return {
                left: rect.left + window.scrollX,
                top: rect.top + window.scrollY
            };
        }
    </script>
</body>
</html>
